# postmessage-vulnerability-demo
 
Refer to [Blog Link] for a detailed discussion on HTML 5 post message vulnerabilities.

This repo contains three HTML files demonstrating HTML5 postmessage vulnerabilities

rewards.html - Page hosted on legitimate rewards site
evilrewards.html - Page hosted on malicious site
start.html - Page opened in the popup window

## Setup Details:

The demo can be easily run by setting up a local webserver running at 127.0.0.1
Host entried need to be added in the host file for three different origins. e.g.

127.0.0.1  www.acmerewards.com
127.0.0.1  play.acmerewards.com
127.0.0.1  www.realbadhacker.com

Assuming that the html files are kept inside a directory named 'demo' in the web server root.

## Normal application behavior (Legitimate application opens the popup and passes a string message)

1. Access www.acmerewards.com/demo/rewards.html
2. Click on the play button to open play.acmerewards.com in a popup window
3. Click "OK" in the sender window and observe the post message being received in the popup window which updates the HTML
4. The message sent in the above case was "username"

## Exploit scenario (Malicious application opens the popup and injects JS code)

1. Access www.realbadhacker.com/demo/evilrewards.html
2. Click on the play button to open play.acmerewards.com in a popup window
3. Click "OK" in the sender window and observe the post message being received in the popup window which injects malicious JavaScript in the popup window. 
4. The message sent in the above case was "<img src=x onerror=alert('pwned!')>" which got executed in the popup.

Disclaimer: Code samples provided here have been tested with Mozilla Firefox Browser (Version 52.0.1)
